---
title: Ngá»¯ cáº£nh render cá»§a Astro
sidebar:
  label: Ngá»¯ cáº£nh render
i18nReady: true
tableOfContents:
  minHeadingLevel: 2
  maxHeadingLevel: 4
---

import Since from '~/components/Since.astro';
import { Tabs, TabItem } from '@astrojs/starlight/components';
import ReadMore from '~/components/ReadMore.astro';

Khi render má»™t trang, Astro cung cáº¥p má»™t API runtime cá»¥ thá»ƒ cho ngá»¯ cáº£nh render hiá»‡n táº¡i. Äiá»u nÃ y bao gá»“m thÃ´ng tin há»¯u Ã­ch nhÆ° URL trang hiá»‡n táº¡i cÅ©ng nhÆ° cÃ¡c API Ä‘á»ƒ thá»±c hiá»‡n cÃ¡c hÃ nh Ä‘á»™ng nhÆ° chuyá»ƒn hÆ°á»›ng Ä‘áº¿n trang khÃ¡c.

Trong cÃ¡c component `.astro`, ngá»¯ cáº£nh nÃ y cÃ³ sáºµn tá»« Ä‘á»‘i tÆ°á»£ng global `Astro`. CÃ¡c hÃ m endpoint cÅ©ng Ä‘Æ°á»£c gá»i vá»›i cÃ¹ng Ä‘á»‘i tÆ°á»£ng ngá»¯ cáº£nh nÃ y lÃ m Ä‘á»‘i sá»‘ Ä‘áº§u tiÃªn, cÃ³ cÃ¡c thuá»™c tÃ­nh pháº£n Ã¡nh cÃ¡c thuá»™c tÃ­nh global Astro.

Má»™t sá»‘ thuá»™c tÃ­nh chá»‰ cÃ³ sáºµn cho cÃ¡c route Ä‘Æ°á»£c render theo yÃªu cáº§u hoáº·c cÃ³ thá»ƒ cÃ³ chá»©c nÄƒng háº¡n cháº¿ trÃªn cÃ¡c trang Ä‘Æ°á»£c prerender.

Äá»‘i tÆ°á»£ng global `Astro` cÃ³ sáºµn cho táº¥t cáº£ cÃ¡c file `.astro`. Sá»­ dá»¥ng Ä‘á»‘i tÆ°á»£ng `context` trong [cÃ¡c hÃ m endpoint](/vi/guides/endpoints/) Ä‘á»ƒ phá»¥c vá»¥ cÃ¡c endpoint tÄ©nh hoáº·c server live vÃ  trong [middleware](/vi/guides/middleware/) Ä‘á»ƒ inject hÃ nh vi khi má»™t trang hoáº·c endpoint sáº¯p Ä‘Æ°á»£c render.

## Äá»‘i tÆ°á»£ng context

CÃ¡c thuá»™c tÃ­nh sau cÃ³ sáºµn trÃªn global `Astro` (vÃ­ dá»¥: `Astro.props`, `Astro.redirect()`) vÃ  cÅ©ng cÃ³ sáºµn trÃªn Ä‘á»‘i tÆ°á»£ng context (vÃ­ dá»¥: `context.props`, `context.redirect()`) Ä‘Æ°á»£c truyá»n cho cÃ¡c hÃ m endpoint vÃ  middleware.

### `props`

`props` lÃ  má»™t Ä‘á»‘i tÆ°á»£ng chá»©a báº¥t ká»³ giÃ¡ trá»‹ nÃ o Ä‘Ã£ Ä‘Æ°á»£c truyá»n nhÆ° [thuá»™c tÃ­nh component](/vi/basics/astro-components/#component-props).

```astro {3}
---
// src/components/Heading.astro
const { title, date } = Astro.props;
---
<div>
  <h1>{title}</h1>
  <p>{date}</p>
</div>
```

```astro "title=" "date="
---
// src/pages/index.astro
import Heading from '../components/Heading.astro';
---
<Heading title="My First Post" date="09 Aug 2022" />
```

<ReadMore>TÃ¬m hiá»ƒu thÃªm vá» cÃ¡ch [layout Markdown vÃ  MDX](/vi/guides/markdown-content/#frontmatter-layout-property) xá»­ lÃ½ props.</ReadMore>

Äá»‘i tÆ°á»£ng `props` cÅ©ng chá»©a báº¥t ká»³ `props` nÃ o Ä‘Æ°á»£c truyá»n tá»« `getStaticPaths()` khi render cÃ¡c route tÄ©nh.

<Tabs>
  <TabItem label="Astro.props">
    ```astro title="src/pages/posts/[id].astro" "props:" {11}
    ---
    export function getStaticPaths() {
      return [
        { params: { id: '1' }, props: { author: 'Blu' } },
        { params: { id: '2' }, props: { author: 'Erika' } },
        { params: { id: '3' }, props: { author: 'Matthew' } }
      ];
    }

    const { id } = Astro.params;
    const { author } = Astro.props;
    ---
    ```

  </TabItem>
  <TabItem label="context.props">
    ```ts title="src/pages/posts/[id].json.ts" "props:" {11-15}
    import type { APIContext } from 'astro';

    export function getStaticPaths() {
      return [
        { params: { id: '1' }, props: { author: 'Blu' } },
        { params: { id: '2' }, props: { author: 'Erika' } },
        { params: { id: '3' }, props: { author: 'Matthew' } }
      ];
    }

    export function GET({ props }: APIContext) {
      return new Response(
        JSON.stringify({ author: props.author }),
      );
    }
    ```

  </TabItem>

</Tabs>
Xem thÃªm: [Truyá»n dá»¯ liá»‡u vá»›i `props`](/vi/reference/routing-reference/#data-passing-with-props)

### `params`

`params` lÃ  má»™t Ä‘á»‘i tÆ°á»£ng chá»©a cÃ¡c giÃ¡ trá»‹ cá»§a cÃ¡c segment route Ä‘á»™ng Ä‘Æ°á»£c khá»›p cho má»™t request. CÃ¡c key cá»§a nÃ³ pháº£i khá»›p vá»›i [cÃ¡c tham sá»‘](/vi/guides/routing/#dynamic-routes) trong Ä‘Æ°á»ng dáº«n file trang hoáº·c endpoint.

Trong cÃ¡c build tÄ©nh, Ä‘Ã¢y sáº½ lÃ  `params` Ä‘Æ°á»£c tráº£ vá» bá»Ÿi `getStaticPaths()` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ prerender [cÃ¡c route Ä‘á»™ng](/vi/guides/routing/#dynamic-routes):

<Tabs>
  <TabItem label="Astro.params">
    ```astro title="src/pages/posts/[id].astro" {9} "params:"
    ---
    export function getStaticPaths() {
      return [
        { params: { id: '1' } },
        { params: { id: '2' } },
        { params: { id: '3' } }
      ];
    }
    const { id } = Astro.params;
    ---
    <h1>{id}</h1>
    ```
  </TabItem>
  <TabItem label="context.params">
    ```ts title="src/pages/posts/[id].json.ts" "params:" {11-15}
    import type { APIContext } from 'astro';

    export function getStaticPaths() {
      return [
        { params: { id: '1' } },
        { params: { id: '2' } },
        { params: { id: '3' } }
      ];
    }

    export function GET({ params }: APIContext) {
      return new Response(
        JSON.stringify({ id: params.id }),
      );
    }
    ```

  </TabItem>
</Tabs>

Khi cÃ¡c route Ä‘Æ°á»£c render theo yÃªu cáº§u, `params` cÃ³ thá»ƒ lÃ  báº¥t ká»³ giÃ¡ trá»‹ nÃ o khá»›p vá»›i cÃ¡c segment Ä‘Æ°á»ng dáº«n trong pattern route Ä‘á»™ng.

```astro title="src/pages/posts/[id].astro" "Astro.params"
---
import { getPost } from '../api';

const post = await getPost(Astro.params.id);

// KhÃ´ng tÃ¬m tháº¥y bÃ i viáº¿t nÃ o vá»›i ID nÃ y
if (!post) {
  return Astro.redirect("/404")
}
---
<html>
  <h1>{post.name}</h1>
</html>
```

Xem thÃªm: [`params`](/vi/reference/routing-reference/#params)

### `url`

<p>

**Type:** `URL`<br />

<Since v="1.0.0" />
</p>

`url` lÃ  má»™t Ä‘á»‘i tÆ°á»£ng [URL](https://developer.mozilla.org/en-US/docs/Web/API/URL) Ä‘Æ°á»£c táº¡o tá»« giÃ¡ trá»‹ `request.url` hiá»‡n táº¡i. NÃ³ há»¯u Ã­ch Ä‘á»ƒ tÆ°Æ¡ng tÃ¡c vá»›i cÃ¡c thuá»™c tÃ­nh riÃªng láº» cá»§a URL request, nhÆ° pathname vÃ  origin.

`Astro.url` tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i viá»‡c thá»±c hiá»‡n `new URL(Astro.request.url)`.

`url` sáº½ lÃ  má»™t URL `localhost` trong cháº¿ Ä‘á»™ dev. Khi build má»™t site, cÃ¡c route prerender sáº½ nháº­n má»™t URL dá»±a trÃªn cÃ¡c tÃ¹y chá»n [`site`](/vi/reference/configuration-reference/#site) vÃ  [`base`](/vi/reference/configuration-reference/#base). Náº¿u `site` khÃ´ng Ä‘Æ°á»£c cáº¥u hÃ¬nh, cÃ¡c trang prerender cÅ©ng sáº½ nháº­n URL `localhost` trong quÃ¡ trÃ¬nh build.

```astro title="src/pages/index.astro" "Astro.url"
<h1>URL hiá»‡n táº¡i lÃ : {Astro.url}</h1>
<h1>Pathname cá»§a URL hiá»‡n táº¡i lÃ : {Astro.url.pathname}</h1>
<h1>Origin cá»§a URL hiá»‡n táº¡i lÃ : {Astro.url.origin}</h1>
```

Báº¡n cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng `url` Ä‘á»ƒ táº¡o URL má»›i báº±ng cÃ¡ch truyá»n nÃ³ nhÆ° má»™t Ä‘á»‘i sá»‘ cho [`new URL()`](https://developer.mozilla.org/en-US/docs/Web/API/URL/URL).

```astro title="src/pages/index.astro" "Astro.url"
---
// VÃ­ dá»¥: Táº¡o má»™t canonical URL báº±ng domain production cá»§a báº¡n
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
// VÃ­ dá»¥: Táº¡o má»™t URL cho tháº» meta SEO báº±ng domain hiá»‡n táº¡i cá»§a báº¡n
const socialImageURL = new URL('/images/preview.png', Astro.url);
---
<link rel="canonical" href={canonicalURL} />
<meta property="og:image" content={socialImageURL} />
```

### `site`

<p>

**Type:** `URL | undefined`

</p>

`site` tráº£ vá» má»™t `URL` Ä‘Æ°á»£c táº¡o tá»« `site` trong cáº¥u hÃ¬nh Astro cá»§a báº¡n. NÃ³ tráº£ vá» `undefined` náº¿u báº¡n chÆ°a Ä‘áº·t giÃ¡ trá»‹ cho [`site`](/vi/reference/configuration-reference/#site) trong cáº¥u hÃ¬nh Astro cá»§a báº¡n.

```astro title="src/pages/index.astro" "Astro.site"
<link
    rel="alternate"
    type="application/rss+xml"
    title="TiÃªu Ä‘á» Site cá»§a báº¡n"
    href={new URL("rss.xml", Astro.site)}
/>
```

### `clientAddress`

<p>

**Type:** `string`<br />

<Since v="1.0.0" />
</p>

`clientAddress` chá»‰ Ä‘á»‹nh [Ä‘á»‹a chá»‰ IP](https://en.wikipedia.org/wiki/IP_address) cá»§a request. Thuá»™c tÃ­nh nÃ y chá»‰ cÃ³ sáºµn cho cÃ¡c route Ä‘Æ°á»£c render theo yÃªu cáº§u vÃ  khÃ´ng thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng trÃªn cÃ¡c trang prerender.

<Tabs>
  <TabItem label="Astro.clientAddress">
    ```astro title="src/pages/ip-address.astro" "Astro.clientAddress"
    ---
    export const prerender = false; // KhÃ´ng cáº§n thiáº¿t trong cháº¿ Ä‘á»™ 'server'
    ---

    <div>Äá»‹a chá»‰ IP cá»§a báº¡n lÃ : <span class="address">{Astro.clientAddress}</span></div>
    ```

  </TabItem>
  <TabItem label="context.clientAddress">
    ```ts title="src/pages/ip-address.ts" "clientAddress"
    export const prerender = false; // KhÃ´ng cáº§n thiáº¿t trong cháº¿ Ä‘á»™ 'server'
    import type { APIContext } from 'astro';

    export function GET({ clientAddress }: APIContext) {
      return new Response(`Äá»‹a chá»‰ IP cá»§a báº¡n lÃ : ${clientAddress}`);
    }
    ```

  </TabItem>
</Tabs>

### `isPrerendered`

<p>

**Type**: `boolean`<br />

<Since v="5.0.0" />
</p>

Má»™t boolean Ä‘áº¡i diá»‡n cho viá»‡c trang hiá»‡n táº¡i cÃ³ Ä‘Æ°á»£c prerender hay khÃ´ng.

Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng thuá»™c tÃ­nh nÃ y Ä‘á»ƒ cháº¡y logic cÃ³ Ä‘iá»u kiá»‡n trong middleware, vÃ­ dá»¥, Ä‘á»ƒ trÃ¡nh truy cáº­p headers trong cÃ¡c trang prerender.

### `generator`

<p>

**Type:** `string`<br />

<Since v="1.0.0" />
</p>

`generator` cung cáº¥p phiÃªn báº£n hiá»‡n táº¡i cá»§a Astro mÃ  dá»± Ã¡n cá»§a báº¡n Ä‘ang cháº¡y. ÄÃ¢y lÃ  cÃ¡ch thuáº­n tiá»‡n Ä‘á»ƒ thÃªm tháº» [`<meta name="generator">`](https://html.spec.whatwg.org/multipage/semantics.html#meta-generator) vá»›i phiÃªn báº£n hiá»‡n táº¡i cá»§a Astro. NÃ³ theo Ä‘á»‹nh dáº¡ng `"Astro v5.x.x"`.

<Tabs>
  <TabItem label="Astro.generator">
    ```astro title="src/pages/site-info.astro" "Astro.generator"
    <html>
      <head>
        <meta name="generator" content={Astro.generator} />
      </head>
      <body>
        <footer>
          <p>ÄÆ°á»£c xÃ¢y dá»±ng vá»›i <a href="https://astro.build">{Astro.generator}</a></p>
        </footer>
      </body>
    </html>
    ```
  </TabItem>
  <TabItem label="context.generator">
    ```ts title="src/pages/site-info.json.ts" "generator"
    import type { APIContext } from 'astro';

    export function GET({ generator, site }: APIContext) {
      const body = JSON.stringify({ generator, site });
      return new Response(body);
    }
    ```

  </TabItem>
</Tabs>

### `request`

<p>

**Type:** `Request`

</p>

`request` lÃ  má»™t Ä‘á»‘i tÆ°á»£ng [Request](https://developer.mozilla.org/en-US/docs/Web/API/Request) tiÃªu chuáº©n. NÃ³ cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ láº¥y `url`, `headers`, `method`, vÃ  tháº­m chÃ­ body cá»§a request.

<Tabs>
  <TabItem label="Astro.request">
    ```astro wrap title="src/pages/index.astro" "Astro.request"
    <p>ÄÃ£ nháº­n má»™t request {Astro.request.method} Ä‘áº¿n "{Astro.request.url}".</p>
    <p>Headers request Ä‘Ã£ nháº­n:</p>
    <p><code>{JSON.stringify(Object.fromEntries(Astro.request.headers))}</code></p>
    ```
  </TabItem>
  <TabItem label="context.request">
    ```ts "request"
    import type { APIContext } from 'astro';

    export function GET({ request }: APIContext) {
      return new Response(`Xin chÃ o ${request.url}`);
    }
    ```

  </TabItem>
</Tabs>

:::note
TrÃªn cÃ¡c trang prerender, `request.url` khÃ´ng chá»©a search parameters, nhÆ° `?type=new`, vÃ¬ khÃ´ng thá»ƒ xÃ¡c Ä‘á»‹nh chÃºng trÆ°á»›c thá»i gian trong quÃ¡ trÃ¬nh build tÄ©nh. Tuy nhiÃªn, `request.url` cÃ³ chá»©a search parameters cho cÃ¡c trang Ä‘Æ°á»£c render theo yÃªu cáº§u vÃ¬ chÃºng cÃ³ thá»ƒ Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh tá»« server request.
:::

### `response`

<p>

**Type:** `ResponseInit & { readonly headers: Headers }`

</p>

`response` lÃ  má»™t Ä‘á»‘i tÆ°á»£ng `ResponseInit` tiÃªu chuáº©n. NÃ³ cÃ³ cáº¥u trÃºc sau.

- `status`: MÃ£ tráº¡ng thÃ¡i sá»‘ cá»§a response, vÃ­ dá»¥: `200`.
- `statusText`: ThÃ´ng bÃ¡o tráº¡ng thÃ¡i liÃªn quan Ä‘áº¿n mÃ£ tráº¡ng thÃ¡i, vÃ­ dá»¥: `'OK'`.
- `headers`: Má»™t instance [`Headers`](https://developer.mozilla.org/en-US/docs/Web/API/Headers) mÃ  báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng Ä‘á»ƒ Ä‘áº·t HTTP headers cá»§a response.

`Astro.response` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ Ä‘áº·t `status`, `statusText`, vÃ  `headers` cho response cá»§a má»™t trang.

```astro "Astro.response"
---
if (condition) {
  Astro.response.status = 404;
  Astro.response.statusText = 'KhÃ´ng tÃ¬m tháº¥y';
}
---
```

Hoáº·c Ä‘á»ƒ Ä‘áº·t má»™t header:

```astro "Astro.response"
---
Astro.response.headers.set('Set-Cookie', 'a=b; Path=/;');
---
```

### `redirect()`

<p>

**Type:** `(path: string, status?: number) => Response`

<Since v="1.5.0" />
</p>

`redirect()` tráº£ vá» má»™t Ä‘á»‘i tÆ°á»£ng [Response](https://developer.mozilla.org/en-US/docs/Web/API/Response) cho phÃ©p báº¡n chuyá»ƒn hÆ°á»›ng Ä‘áº¿n trang khÃ¡c, vÃ  tÃ¹y chá»n cung cáº¥p [mÃ£ tráº¡ng thÃ¡i HTTP response](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status#redirection_messages) lÃ m tham sá»‘ thá»© hai.

Má»™t trang (vÃ  khÃ´ng pháº£i component con) pháº£i `return` káº¿t quáº£ cá»§a `Astro.redirect()` Ä‘á»ƒ chuyá»ƒn hÆ°á»›ng xáº£y ra.

Äá»‘i vá»›i cÃ¡c route Ä‘Æ°á»£c táº¡o tÄ©nh, Ä‘iá»u nÃ y sáº½ táº¡o ra má»™t chuyá»ƒn hÆ°á»›ng client báº±ng tháº» [`<meta http-equiv="refresh">`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/meta#http-equiv) vÃ  khÃ´ng há»— trá»£ mÃ£ tráº¡ng thÃ¡i.

Äá»‘i vá»›i cÃ¡c route Ä‘Æ°á»£c render theo yÃªu cáº§u, viá»‡c Ä‘áº·t mÃ£ tráº¡ng thÃ¡i tÃ¹y chá»‰nh Ä‘Æ°á»£c há»— trá»£ khi chuyá»ƒn hÆ°á»›ng. Náº¿u khÃ´ng chá»‰ Ä‘á»‹nh, chuyá»ƒn hÆ°á»›ng sáº½ Ä‘Æ°á»£c phá»¥c vá»¥ vá»›i mÃ£ tráº¡ng thÃ¡i `302`.

VÃ­ dá»¥ sau chuyá»ƒn hÆ°á»›ng ngÆ°á»i dÃ¹ng Ä‘áº¿n trang Ä‘Äƒng nháº­p:

<Tabs>
  <TabItem label="Astro.redirect()">
    ```astro title="src/pages/account.astro" {8} "Astro.redirect"
    ---
    import { isLoggedIn } from '../utils';

    const cookie = Astro.request.headers.get('cookie');

    // Náº¿u ngÆ°á»i dÃ¹ng chÆ°a Ä‘Äƒng nháº­p, chuyá»ƒn hÆ°á»›ng há» Ä‘áº¿n trang Ä‘Äƒng nháº­p
    if (!isLoggedIn(cookie)) {
      return Astro.redirect('/login');
    }
    ---

    <p>ThÃ´ng tin ngÆ°á»i dÃ¹ng</p>
    ```

  </TabItem>
  <TabItem label="context.redirect()">
    ```ts "redirect"
    import type { APIContext } from 'astro';

    export function GET({ redirect, request }: APIContext) {
      const cookie = request.headers.get('cookie');
      if (!isLoggedIn(cookie)) {
        return redirect('/login', 302);
      } else {
        // tráº£ vá» thÃ´ng tin ngÆ°á»i dÃ¹ng
      }
    }
    ```

  </TabItem>
</Tabs>

### `rewrite()`

<p>

**Type:** `(rewritePayload: string | URL | Request) => Promise<Response>`<br />

<Since v="4.13.0" />
</p>

`rewrite()` cho phÃ©p báº¡n phá»¥c vá»¥ ná»™i dung tá»« má»™t URL hoáº·c Ä‘Æ°á»ng dáº«n khÃ¡c mÃ  khÃ´ng chuyá»ƒn hÆ°á»›ng trÃ¬nh duyá»‡t Ä‘áº¿n trang má»›i.

PhÆ°Æ¡ng thá»©c cháº¥p nháº­n má»™t string, má»™t `URL`, hoáº·c má»™t `Request` cho vá»‹ trÃ­ cá»§a Ä‘Æ°á»ng dáº«n.

Sá»­ dá»¥ng string Ä‘á»ƒ cung cáº¥p má»™t Ä‘Æ°á»ng dáº«n rÃµ rÃ ng:

<Tabs syncKey="rewrite">
  <TabItem label="Astro.rewrite()">
    ```astro title="src/pages/index.astro" "Astro.rewrite"
    ---
    return Astro.rewrite("/login")
    ---
    ```
  </TabItem>
  <TabItem label="context.rewrite()">
    ```ts "rewrite"
    import type { APIContext } from 'astro';

    export function GET({ rewrite }: APIContext) {
      return rewrite('/login');
    }
    ```

  </TabItem>
</Tabs>

Sá»­ dá»¥ng kiá»ƒu `URL` khi báº¡n cáº§n xÃ¢y dá»±ng Ä‘Æ°á»ng dáº«n URL cho rewrite. VÃ­ dá»¥ sau render má»™t trang vá»›i Ä‘Æ°á»ng dáº«n cha báº±ng cÃ¡ch táº¡o má»™t URL má»›i tá»« Ä‘Æ°á»ng dáº«n tÆ°Æ¡ng Ä‘á»‘i `"../"`:

<Tabs syncKey="rewrite">
  <TabItem label="Astro.rewrite()">
    ```astro title="src/pages/blog/index.astro"
    ---
    return Astro.rewrite(new URL("../", Astro.url))
    ---
    ```
  </TabItem>
  <TabItem label="context.rewrite()">
    ```ts
    import type { APIContext } from 'astro';

    export function GET({ rewrite }: APIContext) {
      return rewrite(new URL("../", Astro.url));
    }
    ```

  </TabItem>
</Tabs>

Sá»­ dá»¥ng kiá»ƒu `Request` Ä‘á»ƒ cÃ³ toÃ n quyá»n kiá»ƒm soÃ¡t `Request` Ä‘Æ°á»£c gá»­i Ä‘áº¿n server cho Ä‘Æ°á»ng dáº«n má»›i. VÃ­ dá»¥ sau gá»­i má»™t request Ä‘á»ƒ render trang cha Ä‘á»“ng thá»i cung cáº¥p headers:

<Tabs syncKey="rewrite">
  <TabItem label="Astro.rewrite()">
    ```astro title="src/pages/blog/index.astro"
    ---
    return Astro.rewrite(new Request(new URL("../", Astro.url), {
      headers: {
        "x-custom-header": JSON.stringify(Astro.locals.someValue)
      }
    }))
    ---
    ```
  </TabItem>
  <TabItem label="context.rewrite()">
    ```ts
    import type { APIContext } from 'astro';

    export function GET({ rewrite }: APIContext) {
      return rewrite(new Request(new URL("../", Astro.url), {
        headers: {
          "x-custom-header": JSON.stringify(Astro.locals.someValue)
        }
      }));
    }
    ```

  </TabItem>
</Tabs>

### `locals`

<p>

<Since v="2.4.0" />
</p>

`locals` lÃ  má»™t Ä‘á»‘i tÆ°á»£ng Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ lÆ°u trá»¯ vÃ  truy cáº­p thÃ´ng tin tÃ¹y Ã½ trong vÃ²ng Ä‘á»i cá»§a má»™t request. `Astro.locals` lÃ  má»™t Ä‘á»‘i tÆ°á»£ng chá»©a báº¥t ká»³ giÃ¡ trá»‹ nÃ o tá»« Ä‘á»‘i tÆ°á»£ng `context.locals` Ä‘Æ°á»£c Ä‘áº·t bá»Ÿi middleware. Sá»­ dá»¥ng Ä‘iá»u nÃ y Ä‘á»ƒ truy cáº­p dá»¯ liá»‡u Ä‘Æ°á»£c tráº£ vá» bá»Ÿi middleware trong cÃ¡c file `.astro` cá»§a báº¡n.

CÃ¡c hÃ m middleware cÃ³ thá»ƒ Ä‘á»c vÃ  ghi cÃ¡c giÃ¡ trá»‹ cá»§a `context.locals`:

```ts title="src/middleware.ts" "locals"
import type { MiddlewareHandler } from 'astro';

export const onRequest: MiddlewareHandler = ({ locals }, next) => {
	if (!locals.title) {
		locals.title = 'TiÃªu Ä‘á» máº·c Ä‘á»‹nh';
	}
	return next();
};
```

CÃ¡c component Astro vÃ  API endpoint cÃ³ thá»ƒ Ä‘á»c giÃ¡ trá»‹ tá»« `locals` khi chÃºng render:

<Tabs>
  <TabItem label="Astro.locals">
    ```astro title="src/pages/Orders.astro" "Astro.locals"
    ---
    const title = Astro.locals.title;
    ---
    <h1>{title}</h1>
    ```
  </TabItem>
  <TabItem label="context.locals">
    ```ts title="src/pages/hello.ts" "locals"
    import type { APIContext } from 'astro';

    export function GET({ locals }: APIContext) {
      return new Response(locals.title); // "TiÃªu Ä‘á» máº·c Ä‘á»‹nh"
    }
    ```

  </TabItem>
</Tabs>

### `preferredLocale`

<p>

**Type:** `string | undefined`<br />

<Since v="3.5.0" />
</p>

`preferredLocale` lÃ  má»™t giÃ¡ trá»‹ Ä‘Æ°á»£c tÃ­nh toÃ¡n Ä‘á»ƒ tÃ¬m sá»± khá»›p tá»‘t nháº¥t giá»¯a tÃ¹y chá»n ngÃ´n ngá»¯ trÃ¬nh duyá»‡t cá»§a khÃ¡ch truy cáº­p vÃ  cÃ¡c locale Ä‘Æ°á»£c há»— trá»£ bá»Ÿi site cá»§a báº¡n.

NÃ³ Ä‘Æ°á»£c tÃ­nh toÃ¡n báº±ng cÃ¡ch kiá»ƒm tra cÃ¡c locale Ä‘Æ°á»£c cáº¥u hÃ¬nh trong máº£ng [`i18n.locales`](/vi/reference/configuration-reference/#i18nlocales) cá»§a báº¡n vÃ  cÃ¡c locale Ä‘Æ°á»£c há»— trá»£ bá»Ÿi trÃ¬nh duyá»‡t cá»§a ngÆ°á»i dÃ¹ng thÃ´ng qua header `Accept-Language`. GiÃ¡ trá»‹ nÃ y lÃ  `undefined` náº¿u khÃ´ng cÃ³ sá»± khá»›p nÃ o tá»“n táº¡i.

Thuá»™c tÃ­nh nÃ y chá»‰ cÃ³ sáºµn cho cÃ¡c route Ä‘Æ°á»£c render theo yÃªu cáº§u vÃ  khÃ´ng thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng trÃªn cÃ¡c trang tÄ©nh, prerender.

### `preferredLocaleList`

<p>

**Type:** `string[] | undefined`<br />

<Since v="3.5.0" />
</p>

`preferredLocaleList` Ä‘áº¡i diá»‡n cho máº£ng cá»§a táº¥t cáº£ locale Ä‘Æ°á»£c cáº£ trÃ¬nh duyá»‡t yÃªu cáº§u vÃ  Ä‘Æ°á»£c há»— trá»£ bá»Ÿi website cá»§a báº¡n. Äiá»u nÃ y táº¡o ra má»™t danh sÃ¡ch táº¥t cáº£ cÃ¡c ngÃ´n ngá»¯ tÆ°Æ¡ng thÃ­ch giá»¯a site cá»§a báº¡n vÃ  khÃ¡ch truy cáº­p.

Náº¿u khÃ´ng cÃ³ ngÃ´n ngá»¯ nÃ o Ä‘Æ°á»£c yÃªu cáº§u bá»Ÿi trÃ¬nh duyá»‡t Ä‘Æ°á»£c tÃ¬m tháº¥y trong máº£ng locales cá»§a báº¡n, thÃ¬ giÃ¡ trá»‹ lÃ  `[]`. Äiá»u nÃ y xáº£y ra khi báº¡n khÃ´ng há»— trá»£ báº¥t ká»³ locale Æ°a thÃ­ch nÃ o cá»§a khÃ¡ch truy cáº­p.

Náº¿u trÃ¬nh duyá»‡t khÃ´ng chá»‰ Ä‘á»‹nh báº¥t ká»³ ngÃ´n ngá»¯ Æ°a thÃ­ch nÃ o, thÃ¬ giÃ¡ trá»‹ nÃ y sáº½ lÃ  [`i18n.locales`](/vi/reference/configuration-reference/#i18nlocales): táº¥t cáº£ cÃ¡c locale Ä‘Æ°á»£c há»— trá»£ cá»§a báº¡n sáº½ Ä‘Æ°á»£c coi lÃ  Æ°a thÃ­ch báº±ng nhau bá»Ÿi khÃ¡ch truy cáº­p khÃ´ng cÃ³ tÃ¹y chá»n.

Thuá»™c tÃ­nh nÃ y chá»‰ cÃ³ sáºµn cho cÃ¡c route Ä‘Æ°á»£c render theo yÃªu cáº§u vÃ  khÃ´ng thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng trÃªn cÃ¡c trang tÄ©nh, prerender.

### `currentLocale`

<p>

**Type:** `string | undefined`<br />

<Since v="3.5.6" />
</p>

Locale Ä‘Æ°á»£c tÃ­nh toÃ¡n tá»« URL hiá»‡n táº¡i, sá»­ dá»¥ng cÃº phÃ¡p Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh trong cáº¥u hÃ¬nh `locales` cá»§a báº¡n. Náº¿u URL khÃ´ng chá»©a tiá»n tá»‘ Ä‘Æ°á»ng dáº«n `/[locale]/`, thÃ¬ giÃ¡ trá»‹ sáº½ máº·c Ä‘á»‹nh lÃ  [`i18n.defaultLocale`](/vi/reference/configuration-reference/#i18ndefaultlocale).

### `getActionResult()`

<p>
**Type:** `(action: TAction) => ActionReturnType<TAction> | undefined`<br />
<Since v="4.15.0" />
</p>

`getActionResult()` lÃ  má»™t hÃ m tráº£ vá» káº¿t quáº£ cá»§a má»™t submission [Action](/vi/guides/actions/). HÃ m nÃ y cháº¥p nháº­n má»™t hÃ m action lÃ m Ä‘á»‘i sá»‘ (vÃ­ dá»¥: `actions.logout`) vÃ  tráº£ vá» má»™t Ä‘á»‘i tÆ°á»£ng `data` hoáº·c `error` khi nháº­n Ä‘Æ°á»£c submission. Náº¿u khÃ´ng, nÃ³ sáº½ tráº£ vá» `undefined`.

```astro title="src/pages/index.astro" "Astro.getActionResult"
---
import { actions } from 'astro:actions';

const result = Astro.getActionResult(actions.logout);
---

<form action={actions.logout}>
  <button type="submit">ÄÄƒng xuáº¥t</button>
</form>
{result?.error && <p>ÄÄƒng xuáº¥t tháº¥t báº¡i. Vui lÃ²ng thá»­ láº¡i.</p>}
```

### `callAction()`

<p>
	<Since v='4.15.0' />
</p>

`callAction()` lÃ  má»™t hÃ m Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ gá»i má»™t Action handler trá»±c tiáº¿p tá»« component Astro cá»§a báº¡n. HÃ m nÃ y cháº¥p nháº­n má»™t hÃ m Action lÃ m Ä‘á»‘i sá»‘ Ä‘áº§u tiÃªn (vÃ­ dá»¥: `actions.logout`) vÃ  báº¥t ká»³ input nÃ o mÃ  action Ä‘Ã³ nháº­n lÃ m Ä‘á»‘i sá»‘ thá»© hai. NÃ³ tráº£ vá» káº¿t quáº£ cá»§a action dÆ°á»›i dáº¡ng promise.

```astro title="src/pages/index.astro" "Astro.callAction"
---
import { actions } from 'astro:actions';

const { data, error } = await Astro.callAction(actions.logout, { userId: '123' });
---
```

### `routePattern`

<p>

**Type**: `string`<br />

<Since v="5.0.0" />
</p>

Pattern route chá»‹u trÃ¡ch nhiá»‡m táº¡o ra trang hoáº·c route hiá»‡n táº¡i. Trong file-based routing, Ä‘iá»u nÃ y giá»‘ng vá»›i Ä‘Æ°á»ng dáº«n file trong dá»± Ã¡n cá»§a báº¡n Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ táº¡o route. Khi cÃ¡c integration táº¡o route cho dá»± Ã¡n cá»§a báº¡n, `context.routePattern` giá»‘ng vá»›i giÃ¡ trá»‹ cho `injectRoute.pattern`.

GiÃ¡ trá»‹ sáº½ báº¯t Ä‘áº§u vá»›i dáº¥u gáº¡ch chÃ©o Ä‘áº§u vÃ  trÃ´ng giá»‘ng nhÆ° Ä‘Æ°á»ng dáº«n cá»§a má»™t component trang tÆ°Æ¡ng Ä‘á»‘i so vá»›i thÆ° má»¥c `src/pages/` mÃ  khÃ´ng cÃ³ pháº§n má»Ÿ rá»™ng file.

VÃ­ dá»¥, file `src/pages/vi/blog/[slug].astro` sáº½ tráº£ vá» `/vi/blog/[slug]` cho `routePattern`. Má»i trang trÃªn site cá»§a báº¡n Ä‘Æ°á»£c táº¡o bá»Ÿi file Ä‘Ã³ (vÃ­ dá»¥: `/vi/blog/post-1/`, `/vi/blog/post-2/`, v.v.) Ä‘á»u chia sáº» cÃ¹ng má»™t giÃ¡ trá»‹ cho `routePattern`. Trong trÆ°á»ng há»£p cÃ¡c route `index.*`, pattern route sáº½ khÃ´ng bao gá»“m tá»« "index." VÃ­ dá»¥, `src/pages/index.astro` sáº½ tráº£ vá» `/`.

Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng thuá»™c tÃ­nh nÃ y Ä‘á»ƒ hiá»ƒu route nÃ o Ä‘ang render component cá»§a báº¡n. Äiá»u nÃ y cho phÃ©p báº¡n nháº¯m má»¥c tiÃªu hoáº·c phÃ¢n tÃ­ch cÃ¡c URL trang Ä‘Æ°á»£c táº¡o tÆ°Æ¡ng tá»± cÃ¹ng nhau. VÃ­ dá»¥, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng nÃ³ Ä‘á»ƒ hiá»ƒn thá»‹ thÃ´ng tin nháº¥t Ä‘á»‹nh cÃ³ Ä‘iá»u kiá»‡n, hoáº·c thu tháº­p sá»‘ liá»‡u vá» nhá»¯ng route nÃ o cháº­m hÆ¡n.

### `cookies`

<p>

**Type:** `AstroCookies`<br />

<Since v="1.4.0" />
</p>

`cookies` chá»©a cÃ¡c tiá»‡n Ã­ch Ä‘á»ƒ Ä‘á»c vÃ  thao tÃ¡c cookies cho [cÃ¡c route Ä‘Æ°á»£c render theo yÃªu cáº§u](/vi/guides/on-demand-rendering/).

#### Tiá»‡n Ã­ch cookie

##### `cookies.get()`

<p>

**Type:** <code>(key: string, options?: <a href="#astrocookiegetoptions">AstroCookieGetOptions</a>) => <a href="#astrocookie-type">AstroCookie</a> | undefined</code>

</p>

Láº¥y cookie dÆ°á»›i dáº¡ng Ä‘á»‘i tÆ°á»£ng [`AstroCookie`](#astrocookie-type), chá»©a `value` vÃ  cÃ¡c hÃ m tiá»‡n Ã­ch Ä‘á»ƒ chuyá»ƒn Ä‘á»•i cookie sang cÃ¡c kiá»ƒu khÃ´ng pháº£i string.

##### `cookies.has()`

<p>

**Type:** <code>(key: string, options?: <a href="#astrocookiegetoptions">AstroCookieGetOptions</a>) => boolean</code>

</p>

Liá»‡u cookie nÃ y cÃ³ tá»“n táº¡i hay khÃ´ng. Náº¿u cookie Ä‘Ã£ Ä‘Æ°á»£c Ä‘áº·t thÃ´ng qua `Astro.cookies.set()` thÃ¬ sáº½ tráº£ vá» true, náº¿u khÃ´ng, nÃ³ sáº½ kiá»ƒm tra cookies trong `Astro.request`.

##### `cookies.set()`

<p>

**Type:** <code>(key: string, value: string | object, options?: <a href="#astrocookiesetoptions">AstroCookieSetOptions</a>) => void</code>

</p>

Äáº·t cookie `key` thÃ nh giÃ¡ trá»‹ Ä‘Ã£ cho. Äiá»u nÃ y sáº½ cá»‘ gáº¯ng chuyá»ƒn Ä‘á»•i giÃ¡ trá»‹ cookie thÃ nh string. TÃ¹y chá»n cung cáº¥p cÃ¡ch Ä‘á»ƒ Ä‘áº·t [cÃ¡c tÃ­nh nÄƒng cookie](https://www.npmjs.com/package/cookie#options-1), nhÆ° `maxAge` hoáº·c `httpOnly`.

##### `cookies.delete()`

<p>

**Type:** `(key: string, options?: AstroCookieDeleteOptions) => void`

</p>

VÃ´ hiá»‡u hÃ³a má»™t cookie báº±ng cÃ¡ch Ä‘áº·t ngÃ y háº¿t háº¡n trong quÃ¡ khá»© (0 trong Unix time).

Má»™t khi cookie Ä‘Æ°á»£c "xÃ³a" (háº¿t háº¡n), `Astro.cookies.has()` sáº½ tráº£ vá» `false` vÃ  `Astro.cookies.get()` sáº½ tráº£ vá» má»™t [`AstroCookie`](#astrocookie-type) vá»›i `value` lÃ  `undefined`. CÃ¡c tÃ¹y chá»n cÃ³ sáºµn khi xÃ³a cookie lÃ : `domain`, `path`, `httpOnly`, `sameSite`, vÃ  `secure`.

##### `cookies.merge()`

<p>

**Type:** `(cookies: AstroCookies) => void`

</p>

Há»£p nháº¥t má»™t instance `AstroCookies` má»›i vÃ o instance hiá»‡n táº¡i. Báº¥t ká»³ cookie má»›i nÃ o sáº½ Ä‘Æ°á»£c thÃªm vÃ o instance hiá»‡n táº¡i vÃ  báº¥t ká»³ cookie nÃ o cÃ³ cÃ¹ng tÃªn sáº½ ghi Ä‘Ã¨ cÃ¡c giÃ¡ trá»‹ hiá»‡n cÃ³.

##### `cookies.headers()`

<p>

**Type:** `() => Iterator<string>`

</p>

Láº¥y cÃ¡c giÃ¡ trá»‹ header cho `Set-Cookie` sáº½ Ä‘Æ°á»£c gá»­i Ä‘i vá»›i response.

#### Kiá»ƒu `AstroCookie`

Kiá»ƒu Ä‘Æ°á»£c tráº£ vá» tá»« viá»‡c láº¥y cookie thÃ´ng qua `Astro.cookies.get()`. NÃ³ cÃ³ cÃ¡c thuá»™c tÃ­nh sau:

##### `value`

<p>

**Type:** `string`

</p>

GiÃ¡ trá»‹ string thÃ´ cá»§a cookie.

##### `json`

<p>

**Type:** `() => Record<string, any>`

</p>

PhÃ¢n tÃ­ch giÃ¡ trá»‹ cookie thÃ´ng qua `JSON.parse()`, tráº£ vá» má»™t Ä‘á»‘i tÆ°á»£ng. Throw náº¿u giÃ¡ trá»‹ cookie khÃ´ng pháº£i JSON há»£p lá»‡.

##### `number`

<p>

**Type:** `() => number`

</p>

PhÃ¢n tÃ­ch giÃ¡ trá»‹ cookie thÃ nh má»™t Number. Tráº£ vá» NaN náº¿u khÃ´ng pháº£i sá»‘ há»£p lá»‡.

##### `boolean`

<p>

**Type:** `() => boolean`

</p>

Chuyá»ƒn Ä‘á»•i giÃ¡ trá»‹ cookie thÃ nh boolean.

#### `AstroCookieGetOptions`

<p>
	<Since v='4.1.0' />
</p>

Interface `AstroCookieGetOption` cho phÃ©p báº¡n chá»‰ Ä‘á»‹nh tÃ¹y chá»n khi láº¥y cookie.

##### `decode`

<p>**Type:** `(value: string) => string`</p>

Cho phÃ©p tÃ¹y chá»‰nh cÃ¡ch cookie Ä‘Æ°á»£c deserialized thÃ nh má»™t giÃ¡ trá»‹.

#### `AstroCookieSetOptions`

<p>
	<Since v='4.1.0' />
</p>

`AstroCookieSetOptions` lÃ  má»™t Ä‘á»‘i tÆ°á»£ng cÃ³ thá»ƒ Ä‘Æ°á»£c truyá»n cho `Astro.cookies.set()` khi Ä‘áº·t cookie Ä‘á»ƒ tÃ¹y chá»‰nh cÃ¡ch cookie Ä‘Æ°á»£c serialized.

##### `domain`

<p>

**Type:** `string`

</p>

Chá»‰ Ä‘á»‹nh domain. Náº¿u khÃ´ng Ä‘áº·t domain, háº§u háº¿t client sáº½ diá»…n giáº£i Ä‘á»ƒ Ã¡p dá»¥ng cho domain hiá»‡n táº¡i.

##### `expires`

<p>

**Type:** `Date`

</p>

Chá»‰ Ä‘á»‹nh ngÃ y cookie sáº½ háº¿t háº¡n.

##### `httpOnly`

<p>

**Type:** `boolean`

</p>

Náº¿u true, cookie sáº½ khÃ´ng thá»ƒ truy cáº­p phÃ­a client.

##### `maxAge`

<p>

**Type:** `number`

</p>

Chá»‰ Ä‘á»‹nh má»™t sá»‘, tÃ­nh báº±ng giÃ¢y, mÃ  cookie cÃ³ hiá»‡u lá»±c.

##### `path`

<p>

**Type:** `string`

</p>

Chá»‰ Ä‘á»‹nh subpath cá»§a domain mÃ  cookie Ä‘Æ°á»£c Ã¡p dá»¥ng.

##### `sameSite`

<p>

**Type:** `boolean | 'lax' | 'none' | 'strict'`

</p>

Chá»‰ Ä‘á»‹nh giÃ¡ trá»‹ cá»§a header cookie [SameSite](https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis-09#section-5.4.7).

##### `secure`

<p>

**Type:** `boolean`

</p>

Náº¿u true, cookie chá»‰ Ä‘Æ°á»£c Ä‘áº·t trÃªn cÃ¡c site https.

##### `encode`

<p>

**Type:** `(value: string) => string`

</p>

Cho phÃ©p tÃ¹y chá»‰nh cÃ¡ch cookie Ä‘Æ°á»£c serialized.

### `session`

<p>

**Type:** `AstroSession`

<Since v='5.7.0' />

</p>

`session` lÃ  má»™t Ä‘á»‘i tÆ°á»£ng cho phÃ©p dá»¯ liá»‡u Ä‘Æ°á»£c lÆ°u trá»¯ giá»¯a cÃ¡c request cho [cÃ¡c route Ä‘Æ°á»£c render theo yÃªu cáº§u](/vi/guides/on-demand-rendering/). NÃ³ Ä‘Æ°á»£c liÃªn káº¿t vá»›i má»™t cookie chá»‰ chá»©a session ID: báº£n thÃ¢n dá»¯ liá»‡u khÃ´ng Ä‘Æ°á»£c lÆ°u trá»¯ trong cookie.

Session Ä‘Æ°á»£c táº¡o khi Ä‘Æ°á»£c sá»­ dá»¥ng láº§n Ä‘áº§u, vÃ  session cookie Ä‘Æ°á»£c tá»± Ä‘á»™ng Ä‘áº·t. Äá»‘i tÆ°á»£ng `session` lÃ  `undefined` náº¿u khÃ´ng cÃ³ session storage nÃ o Ä‘Æ°á»£c cáº¥u hÃ¬nh, hoáº·c náº¿u route hiá»‡n táº¡i Ä‘Æ°á»£c prerender, vÃ  sáº½ log lá»—i náº¿u báº¡n cá»‘ gáº¯ng sá»­ dá»¥ng nÃ³.

Xem [hÆ°á»›ng dáº«n session](/vi/guides/sessions/) Ä‘á»ƒ biáº¿t thÃªm thÃ´ng tin vá» cÃ¡ch sá»­ dá»¥ng session trong dá»± Ã¡n Astro cá»§a báº¡n.

#### `get()`

<p>

**Type**: `(key: string) => Promise<any>`

</p>

Tráº£ vá» giÃ¡ trá»‹ cá»§a key Ä‘Ã£ cho trong session. Náº¿u key khÃ´ng tá»“n táº¡i, nÃ³ tráº£ vá» `undefined`.

<Tabs>
  <TabItem label="Astro.session">
    ```astro title="src/components/Cart.astro" "Astro.session?.get('cart')"
    ---
    const cart = await Astro.session?.get('cart');
    ---
    <button>ğŸ›’ {cart?.length}</button>
    ```
  </TabItem>
  <TabItem label="context.session">
    ```ts title="src/pages/api/cart.ts" "session.get('cart')"
    import type { APIContext } from 'astro';

    export async function GET({ session }: APIContext) {
      const cart = await session.get('cart');
      return Response.json({ cart });
    }
    ```

  </TabItem>
</Tabs>

#### `set()`

<p>

**Type**: `(key: string, value: any, options?: { ttl: number }) => void`

</p>

Äáº·t giÃ¡ trá»‹ cá»§a key Ä‘Ã£ cho trong session. GiÃ¡ trá»‹ cÃ³ thá»ƒ lÃ  báº¥t ká»³ kiá»ƒu serializable nÃ o. PhÆ°Æ¡ng thá»©c nÃ y Ä‘á»“ng bá»™ vÃ  giÃ¡ trá»‹ cÃ³ sáºµn ngay láº­p tá»©c Ä‘á»ƒ truy xuáº¥t, nhÆ°ng nÃ³ khÃ´ng Ä‘Æ°á»£c lÆ°u vÃ o backend cho Ä‘áº¿n cuá»‘i request.

<Tabs>
  <TabItem label="Astro.session">
    ```astro title="src/pages/products/[slug].astro" "Astro.session?.set('lastViewedProduct', slug)"
    ---
    const { slug } = Astro.params;
    Astro.session?.set('lastViewedProduct', slug);
    ---
    ```
  </TabItem>
  <TabItem label="context.session">
    ```ts title="src/pages/api/add-to-cart.ts" "session.set('cart', cart)"
    import type { APIContext } from 'astro';

    export async function POST({ session, request }: APIContext) {
      const cart = await session.get('cart');
      const newItem = await request.json();
      cart.push(newItem);
      // LÆ°u cart Ä‘Ã£ cáº­p nháº­t vÃ o session
      session.set('cart', cart);
      return Response.json({ cart });
    }
    ```

  </TabItem>
</Tabs>

#### `regenerate()`

<p>

**Type**: `() => void`

</p>

TÃ¡i táº¡o session ID. Gá»i Ä‘iá»u nÃ y khi ngÆ°á»i dÃ¹ng Ä‘Äƒng nháº­p hoáº·c nÃ¢ng cáº¥p quyá»n cá»§a há», Ä‘á»ƒ ngÄƒn cháº·n cÃ¡c cuá»™c táº¥n cÃ´ng session fixation.

<Tabs>
  <TabItem label="Astro.session">
    ```astro title="src/pages/welcome.astro" "Astro.session?.regenerate()"
    ---
    Astro.session?.regenerate();
    ---
    ```
  </TabItem>
  <TabItem label="context.session">
    ```ts title="src/pages/api/login.ts" "session.regenerate()"
    import type { APIContext } from 'astro';

    export async function POST({ session }: APIContext) {
      // XÃ¡c thá»±c ngÆ°á»i dÃ¹ng...
      doLogin();
      // TÃ¡i táº¡o session ID Ä‘á»ƒ ngÄƒn cháº·n cÃ¡c cuá»™c táº¥n cÃ´ng session fixation
      session.regenerate();
      return Response.json({ success: true });
    }
    ```

  </TabItem>
</Tabs>

#### `destroy()`

<p>

**Type**: `() => void`

</p>

Há»§y session, xÃ³a cookie vÃ  Ä‘á»‘i tÆ°á»£ng tá»« backend. Gá»i Ä‘iá»u nÃ y khi ngÆ°á»i dÃ¹ng Ä‘Äƒng xuáº¥t hoáº·c session cá»§a há» bá»‹ vÃ´ hiá»‡u hÃ³a.

<Tabs>
  <TabItem label="Astro.session">
    ```astro title="src/pages/logout.astro" "Astro.session?.destroy()"
    ---
    Astro.session?.destroy();
    return Astro.redirect('/login');
    ---
    ```
  </TabItem>
  <TabItem label="context.session">
    ```ts title="src/pages/api/logout.ts" "session.destroy()"
    import type { APIContext } from 'astro';

    export async function POST({ session }: APIContext) {
      session.destroy();
      return Response.json({ success: true });
    }
    ```

  </TabItem>
</Tabs>

#### `load()`

<p>

**Type**: `(id: string) => Promise<void>`

</p>

Táº£i má»™t session theo ID. Trong sá»­ dá»¥ng bÃ¬nh thÆ°á»ng, session Ä‘Æ°á»£c táº£i tá»± Ä‘á»™ng tá»« request cookie. Sá»­ dá»¥ng phÆ°Æ¡ng thá»©c nÃ y Ä‘á»ƒ táº£i session tá»« má»™t ID khÃ¡c. Äiá»u nÃ y há»¯u Ã­ch náº¿u báº¡n Ä‘ang xá»­ lÃ½ session ID cá»§a riÃªng mÃ¬nh, hoáº·c náº¿u báº¡n muá»‘n theo dÃµi session mÃ  khÃ´ng sá»­ dá»¥ng cookies.

<Tabs>
  <TabItem label="Astro.session">
    ```astro title="src/pages/cart.astro" "Astro.session?.load('session-id')"
    ---
    // Táº£i session tá»« header thay vÃ¬ cookies
    const sessionId = Astro.request.headers.get('x-session-id');
    await Astro.session?.load(sessionId);
    const cart = await Astro.session?.get('cart');
    ---
    <h1>Giá» hÃ ng cá»§a báº¡n</h1>
    <ul>
      {cart?.map((item) => (
        <li>{item.name}</li>
      ))}
    </ul>
    ```
  </TabItem>
  <TabItem label="context.session">
    ```ts title="src/pages/api/load-session.ts" "session.load('session-id')"
    import type { APIRoute } from 'astro';

    export const GET: APIRoute = async ({ session, request }) => {
      // Táº£i session tá»« header thay vÃ¬ cookies
      const sessionId = request.headers.get('x-session-id');
      await session.load(sessionId);
      const cart = await session.get('cart');
      return Response.json({ cart });
    };
    ```

  </TabItem>

</Tabs>

### Thuá»™c tÃ­nh Ä‘á»‘i tÆ°á»£ng Ä‘Ã£ deprecated

#### `Astro.glob()`

:::caution[Deprecated trong v5.0]
Sá»­ dá»¥ng [`import.meta.glob` cá»§a Vite](https://vite.dev/guide/features.html#glob-import) Ä‘á»ƒ query cÃ¡c file dá»± Ã¡n.

`Astro.glob('../pages/post/*.md')` cÃ³ thá»ƒ Ä‘Æ°á»£c thay tháº¿ báº±ng:

`Object.values(import.meta.glob('../pages/post/*.md', { eager: true }));`

Xem [hÆ°á»›ng dáº«n imports](/vi/guides/imports/#importmetaglob) Ä‘á»ƒ biáº¿t thÃªm thÃ´ng tin vÃ  cÃ¡ch sá»­ dá»¥ng.
:::

`Astro.glob()` lÃ  má»™t cÃ¡ch Ä‘á»ƒ táº£i nhiá»u file local vÃ o thiáº¿t láº­p site tÄ©nh cá»§a báº¡n.

```astro
---
// src/components/my-component.astro
const posts = await Astro.glob('../pages/post/*.md'); // tráº£ vá» má»™t máº£ng cÃ¡c bÃ i viáº¿t sá»‘ng táº¡i ./src/pages/post/*.md
---

<div>
{posts.slice(0, 3).map((post) => (
  <article>
    <h2>{post.frontmatter.title}</h2>
    <p>{post.frontmatter.description}</p>
    <a href={post.url}>Äá»c thÃªm</a>
  </article>
))}
</div>
```

`.glob()` chá»‰ nháº­n má»™t tham sá»‘: má»™t URL glob tÆ°Æ¡ng Ä‘á»‘i cá»§a nhá»¯ng file local báº¡n muá»‘n import. NÃ³ báº¥t Ä‘á»“ng bá»™ vÃ  tráº£ vá» má»™t máº£ng cÃ¡c exports tá»« cÃ¡c file khá»›p.

`.glob()` khÃ´ng thá»ƒ nháº­n variables hoáº·c strings cÃ³ interpolate chÃºng, vÃ¬ chÃºng khÃ´ng thá»ƒ phÃ¢n tÃ­ch tÄ©nh. (Xem [hÆ°á»›ng dáº«n imports](/vi/guides/imports/#supported-values) Ä‘á»ƒ cÃ³ workaround.) Äiá»u nÃ y lÃ  vÃ¬ `Astro.glob()` lÃ  má»™t wrapper cá»§a [`import.meta.glob()`](https://vite.dev/guide/features.html#glob-import) cá»§a Vite.

:::note
Báº¡n cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng `import.meta.glob()` trá»±c tiáº¿p trong dá»± Ã¡n Astro cá»§a mÃ¬nh. Báº¡n cÃ³ thá»ƒ muá»‘n lÃ m Ä‘iá»u nÃ y khi:

- Báº¡n cáº§n tÃ­nh nÄƒng nÃ y trong má»™t file khÃ´ng pháº£i `.astro`, nhÆ° má»™t API route. `Astro.glob()` chá»‰ cÃ³ sáºµn trong cÃ¡c file `.astro`, trong khi `import.meta.glob()` cÃ³ sáºµn á»Ÿ báº¥t cá»© Ä‘Ã¢u trong dá»± Ã¡n.
- Báº¡n khÃ´ng muá»‘n táº£i tá»«ng file ngay láº­p tá»©c. `import.meta.glob()` cÃ³ thá»ƒ tráº£ vá» cÃ¡c hÃ m import ná»™i dung file, thay vÃ¬ tráº£ vá» chÃ­nh ná»™i dung Ä‘Ã³. LÆ°u Ã½ ráº±ng import nÃ y bao gá»“m táº¥t cáº£ styles vÃ  scripts cho báº¥t ká»³ file Ä‘Æ°á»£c import nÃ o. ChÃºng sáº½ Ä‘Æ°á»£c bundle vÃ  thÃªm vÃ o trang cho dÃ¹ file cÃ³ thá»±c sá»± Ä‘Æ°á»£c sá»­ dá»¥ng hay khÃ´ng, vÃ¬ Ä‘iá»u nÃ y Ä‘Æ°á»£c quyáº¿t Ä‘á»‹nh bá»Ÿi phÃ¢n tÃ­ch tÄ©nh, khÃ´ng pháº£i táº¡i runtime.
- Báº¡n muá»‘n truy cáº­p Ä‘Æ°á»ng dáº«n cá»§a tá»«ng file. `import.meta.glob()` tráº£ vá» má»™t map cá»§a Ä‘Æ°á»ng dáº«n file vá»›i ná»™i dung cá»§a nÃ³, trong khi `Astro.glob()` tráº£ vá» má»™t danh sÃ¡ch ná»™i dung.
- Báº¡n muá»‘n truyá»n nhiá»u pattern; vÃ­ dá»¥, báº¡n muá»‘n thÃªm má»™t "negative pattern" Ä‘á»ƒ lá»c ra má»™t sá»‘ file nháº¥t Ä‘á»‹nh. `import.meta.glob()` cÃ³ thá»ƒ tÃ¹y chá»n nháº­n má»™t máº£ng glob strings, thay vÃ¬ má»™t string duy nháº¥t.

Äá»c thÃªm trong [tÃ i liá»‡u Vite](https://vite.dev/guide/features.html#glob-import).
:::

##### File Markdown

CÃ¡c file Markdown Ä‘Æ°á»£c táº£i vá»›i `Astro.glob()` tráº£ vá» interface `MarkdownInstance` sau:

```ts
export interface MarkdownInstance<T extends Record<string, any>> {
	/* Báº¥t ká»³ dá»¯ liá»‡u nÃ o Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh trong frontmatter YAML/TOML cá»§a file nÃ y */
	frontmatter: T;
	/* ÄÆ°á»ng dáº«n file tuyá»‡t Ä‘á»‘i cá»§a file nÃ y */
	file: string;
	/* ÄÆ°á»ng dáº«n render cá»§a file nÃ y */
	url: string | undefined;
	/* Component Astro render ná»™i dung cá»§a file nÃ y */
	Content: AstroComponentFactory;
	/** (Chá»‰ Markdown) Ná»™i dung file Markdown thÃ´, khÃ´ng bao gá»“m layout HTML vÃ  frontmatter YAML/TOML */
	rawContent(): string;
	/** (Chá»‰ Markdown) File Markdown Ä‘Æ°á»£c biÃªn dá»‹ch thÃ nh HTML, khÃ´ng bao gá»“m layout HTML */
	compiledContent(): string;
	/* HÃ m tráº£ vá» má»™t máº£ng cÃ¡c pháº§n tá»­ h1...h6 trong file nÃ y */
	getHeadings(): Promise<{ depth: number; slug: string; text: string }[]>;
	default: AstroComponentFactory;
}
```

Báº¡n cÃ³ thá»ƒ tÃ¹y chá»n cung cáº¥p má»™t type cho biáº¿n `frontmatter` báº±ng cÃ¡ch sá»­ dá»¥ng TypeScript generic.

```astro
---
interface Frontmatter {
  title: string;
  description?: string;
}
const posts = await Astro.glob<Frontmatter>('../pages/post/*.md');
---

<ul>
  {posts.map(post => <li>{post.frontmatter.title}</li>)}
</ul>
```

##### File Astro

CÃ¡c file Astro cÃ³ interface sau:

```ts
export interface AstroInstance {
	/* ÄÆ°á»ng dáº«n file cá»§a file nÃ y */
	file: string;
	/* URL cho file nÃ y (náº¿u nÃ³ á»Ÿ trong thÆ° má»¥c pages) */
	url: string | undefined;
	default: AstroComponentFactory;
}
```

##### File khÃ¡c

CÃ¡c file khÃ¡c cÃ³ thá»ƒ cÃ³ interface khÃ¡c nhau, nhÆ°ng `Astro.glob()` cháº¥p nháº­n má»™t TypeScript generic náº¿u báº¡n biáº¿t chÃ­nh xÃ¡c má»™t loáº¡i file khÃ´ng Ä‘Æ°á»£c nháº­n dáº¡ng chá»©a gÃ¬.

```ts
---
interface CustomDataFile {
  default: Record<string, any>;
}
const data = await Astro.glob<CustomDataFile>('../data/**/*.js');
---
```
